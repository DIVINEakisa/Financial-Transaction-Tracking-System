/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2026-02-14 10:08:06 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.ftts.model.*;
import com.ftts.dao.*;
import java.util.*;
import java.text.SimpleDateFormat;

public final class transactions_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");

    User user = (User) session.getAttribute("user");
    if (user == null) {
        response.sendRedirect(request.getContextPath() + "/login.jsp");
        return;
    }
    
    TransactionDAO transactionDAO = new TransactionDAO();
    AccountDAO accountDAO = new AccountDAO();
    CategoryDAO categoryDAO = new CategoryDAO();
    
    List<Transaction> transactions = transactionDAO.getTransactionsByUserId(user.getUserId());
    List<Account> accounts = accountDAO.getAccountsByUserId(user.getUserId());
    List<Category> categories = categoryDAO.getAllCategories();
    
    SimpleDateFormat dateFormat = new SimpleDateFormat("MMM dd, yyyy");

      out.write("\r\n");
      out.write("<!DOCTYPE html>\r\n");
      out.write("<html lang=\"en\">\r\n");
      out.write("<head>\r\n");
      out.write("    <meta charset=\"UTF-8\">\r\n");
      out.write("    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n");
      out.write("    <title>Transactions - FTTS</title>\r\n");
      out.write("    <link rel=\"stylesheet\" href=\"");
      out.print( request.getContextPath() );
      out.write("/css/style.css\">\r\n");
      out.write("    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\r\n");
      out.write("</head>\r\n");
      out.write("<body class=\"dashboard-page\">\r\n");
      out.write("    <!-- Sidebar -->\r\n");
      out.write("    <aside class=\"sidebar\">\r\n");
      out.write("        <div class=\"sidebar-header\">\r\n");
      out.write("            <i class=\"fas fa-chart-line\"></i>\r\n");
      out.write("            <span>FTTS</span>\r\n");
      out.write("        </div>\r\n");
      out.write("        <nav class=\"sidebar-nav\">\r\n");
      out.write("            <a href=\"dashboard.jsp\" class=\"nav-item\">\r\n");
      out.write("                <i class=\"fas fa-home\"></i> Dashboard\r\n");
      out.write("            </a>\r\n");
      out.write("            <a href=\"transactions.jsp\" class=\"nav-item active\">\r\n");
      out.write("                <i class=\"fas fa-exchange-alt\"></i> Transactions\r\n");
      out.write("            </a>\r\n");
      out.write("            <a href=\"accounts.jsp\" class=\"nav-item\">\r\n");
      out.write("                <i class=\"fas fa-wallet\"></i> Accounts\r\n");
      out.write("            </a>\r\n");
      out.write("            <a href=\"reports.jsp\" class=\"nav-item\">\r\n");
      out.write("                <i class=\"fas fa-chart-bar\"></i> Reports\r\n");
      out.write("            </a>\r\n");
      out.write("            ");
 if (user.isManager()) { 
      out.write("\r\n");
      out.write("            <a href=\"manager/approvals.jsp\" class=\"nav-item\">\r\n");
      out.write("                <i class=\"fas fa-tasks\"></i> Approvals\r\n");
      out.write("            </a>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("            <a href=\"profile.jsp\" class=\"nav-item\">\r\n");
      out.write("                <i class=\"fas fa-user\"></i> Profile\r\n");
      out.write("            </a>\r\n");
      out.write("        </nav>\r\n");
      out.write("        <div class=\"sidebar-footer\">\r\n");
      out.write("            <a href=\"");
      out.print( request.getContextPath() );
      out.write("/logout\" class=\"nav-item\">\r\n");
      out.write("                <i class=\"fas fa-sign-out-alt\"></i> Logout\r\n");
      out.write("            </a>\r\n");
      out.write("        </div>\r\n");
      out.write("    </aside>\r\n");
      out.write("\r\n");
      out.write("    <!-- Main Content -->\r\n");
      out.write("    <main class=\"main-content\">\r\n");
      out.write("        <div class=\"topbar\">\r\n");
      out.write("            <h1>Transactions</h1>\r\n");
      out.write("            <div class=\"topbar-right\">\r\n");
      out.write("                <button class=\"btn btn-primary\" onclick=\"showAddModal()\">\r\n");
      out.write("                    <i class=\"fas fa-plus\"></i> Add Transaction\r\n");
      out.write("                </button>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <!-- Filter Section -->\r\n");
      out.write("        <div class=\"card\" style=\"margin-bottom: 20px;\">\r\n");
      out.write("            <div style=\"display: flex; gap: 15px; flex-wrap: wrap;\">\r\n");
      out.write("                <div style=\"flex: 1; min-width: 200px;\">\r\n");
      out.write("                    <label style=\"display: block; margin-bottom: 5px; color: var(--text-secondary);\">Type</label>\r\n");
      out.write("                    <select id=\"filterType\" class=\"form-input\" onchange=\"filterTransactions()\">\r\n");
      out.write("                        <option value=\"\">All Types</option>\r\n");
      out.write("                        <option value=\"Income\">Income</option>\r\n");
      out.write("                        <option value=\"Expense\">Expense</option>\r\n");
      out.write("                        <option value=\"Transfer\">Transfer</option>\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div style=\"flex: 1; min-width: 200px;\">\r\n");
      out.write("                    <label style=\"display: block; margin-bottom: 5px; color: var(--text-secondary);\">Account</label>\r\n");
      out.write("                    <select id=\"filterAccount\" class=\"form-input\" onchange=\"filterTransactions()\">\r\n");
      out.write("                        <option value=\"\">All Accounts</option>\r\n");
      out.write("                        ");
 for (Account acc : accounts) { 
      out.write("\r\n");
      out.write("                        <option value=\"");
      out.print( acc.getAccountId() );
      out.write('"');
      out.write('>');
      out.print( acc.getAccountName() );
      out.write("</option>\r\n");
      out.write("                        ");
 } 
      out.write("\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div style=\"flex: 1; min-width: 200px;\">\r\n");
      out.write("                    <label style=\"display: block; margin-bottom: 5px; color: var(--text-secondary);\">Status</label>\r\n");
      out.write("                    <select id=\"filterStatus\" class=\"form-input\" onchange=\"filterTransactions()\">\r\n");
      out.write("                        <option value=\"\">All Status</option>\r\n");
      out.write("                        <option value=\"Completed\">Completed</option>\r\n");
      out.write("                        <option value=\"Pending\">Pending</option>\r\n");
      out.write("                        <option value=\"Approved\">Approved</option>\r\n");
      out.write("                        <option value=\"Rejected\">Rejected</option>\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <!-- Transactions Table -->\r\n");
      out.write("        <div class=\"card\">\r\n");
      out.write("            ");
 if (transactions == null || transactions.isEmpty()) { 
      out.write("\r\n");
      out.write("                <div style=\"text-align: center; padding: 40px; color: var(--text-secondary);\">\r\n");
      out.write("                    <i class=\"fas fa-inbox\" style=\"font-size: 48px; margin-bottom: 15px; opacity: 0.5;\"></i>\r\n");
      out.write("                    <p>No transactions found</p>\r\n");
      out.write("                </div>\r\n");
      out.write("            ");
 } else { 
      out.write("\r\n");
      out.write("                <div class=\"table-responsive\">\r\n");
      out.write("                    <table class=\"data-table\">\r\n");
      out.write("                        <thead>\r\n");
      out.write("                            <tr>\r\n");
      out.write("                                <th>Date</th>\r\n");
      out.write("                                <th>Description</th>\r\n");
      out.write("                                <th>Account</th>\r\n");
      out.write("                                <th>Category</th>\r\n");
      out.write("                                <th>Type</th>\r\n");
      out.write("                                <th>Amount</th>\r\n");
      out.write("                                <th>Status</th>\r\n");
      out.write("                                <th>Actions</th>\r\n");
      out.write("                            </tr>\r\n");
      out.write("                        </thead>\r\n");
      out.write("                        <tbody id=\"transactionsTableBody\">\r\n");
      out.write("                            ");
 
                            AccountDAO tempAccDAO = new AccountDAO();
                            CategoryDAO tempCatDAO = new CategoryDAO();
                            for (Transaction trans : transactions) { 
                                Account acc = tempAccDAO.getAccountById(trans.getAccountId());
                                Category cat = tempCatDAO.getCategoryById(trans.getCategoryId());
                            
      out.write("\r\n");
      out.write("                            <tr data-type=\"");
      out.print( trans.getTransactionType() );
      out.write("\" \r\n");
      out.write("                                data-account=\"");
      out.print( trans.getAccountId() );
      out.write("\" \r\n");
      out.write("                                data-status=\"");
      out.print( trans.getStatus() );
      out.write("\">\r\n");
      out.write("                                <td>");
      out.print( dateFormat.format(trans.getTransactionDate()) );
      out.write("</td>\r\n");
      out.write("                                <td>");
      out.print( trans.getDescription() );
      out.write("</td>\r\n");
      out.write("                                <td>");
      out.print( acc != null ? acc.getAccountName() : "N/A" );
      out.write("</td>\r\n");
      out.write("                                <td>");
      out.print( cat != null ? cat.getCategoryName() : "N/A" );
      out.write("</td>\r\n");
      out.write("                                <td>\r\n");
      out.write("                                    <span class=\"badge ");
      out.print( trans.getTransactionType().toLowerCase() );
      out.write("\">\r\n");
      out.write("                                        ");
      out.print( trans.getTransactionType() );
      out.write("\r\n");
      out.write("                                    </span>\r\n");
      out.write("                                </td>\r\n");
      out.write("                                <td class=\"");
      out.print( "Income".equals(trans.getTransactionType()) ? "text-success" : "text-danger" );
      out.write("\">\r\n");
      out.write("                                    ");
      out.print( "Income".equals(trans.getTransactionType()) ? "+" : "-" );
      out.write("\r\n");
      out.write("                                    $");
      out.print( String.format("%,.2f", trans.getAmount()) );
      out.write("\r\n");
      out.write("                                </td>\r\n");
      out.write("                                <td>\r\n");
      out.write("                                    <span class=\"status-badge status-");
      out.print( trans.getStatus().toLowerCase() );
      out.write("\">\r\n");
      out.write("                                        ");
      out.print( trans.getStatus() );
      out.write("\r\n");
      out.write("                                    </span>\r\n");
      out.write("                                </td>\r\n");
      out.write("                                <td>\r\n");
      out.write("                                    <button class=\"btn-icon\" onclick=\"viewTransaction(");
      out.print( trans.getTransactionId() );
      out.write(")\" title=\"View\">\r\n");
      out.write("                                        <i class=\"fas fa-eye\"></i>\r\n");
      out.write("                                    </button>\r\n");
      out.write("                                    ");
 if ("Completed".equals(trans.getStatus())) { 
      out.write("\r\n");
      out.write("                                    <button class=\"btn-icon text-danger\" onclick=\"deleteTransaction(");
      out.print( trans.getTransactionId() );
      out.write(")\" title=\"Delete\">\r\n");
      out.write("                                        <i class=\"fas fa-trash\"></i>\r\n");
      out.write("                                    </button>\r\n");
      out.write("                                    ");
 } 
      out.write("\r\n");
      out.write("                                </td>\r\n");
      out.write("                            </tr>\r\n");
      out.write("                            ");
 } 
      out.write("\r\n");
      out.write("                        </tbody>\r\n");
      out.write("                    </table>\r\n");
      out.write("                </div>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("    </main>\r\n");
      out.write("\r\n");
      out.write("    <!-- Add Transaction Modal -->\r\n");
      out.write("    <div id=\"addModal\" class=\"modal\">\r\n");
      out.write("        <div class=\"modal-content\">\r\n");
      out.write("            <div class=\"modal-header\">\r\n");
      out.write("                <h2>Add Transaction</h2>\r\n");
      out.write("                <span class=\"close\" onclick=\"closeAddModal()\">&times;</span>\r\n");
      out.write("            </div>\r\n");
      out.write("            <form action=\"");
      out.print( request.getContextPath() );
      out.write("/transaction\" method=\"POST\">\r\n");
      out.write("                <input type=\"hidden\" name=\"action\" value=\"create\">\r\n");
      out.write("                \r\n");
      out.write("                <div class=\"form-group\">\r\n");
      out.write("                    <label>Transaction Type <span style=\"color: red;\">*</span></label>\r\n");
      out.write("                    <select name=\"transactionType\" class=\"form-input\" required onchange=\"updateCategories(this.value)\">\r\n");
      out.write("                        <option value=\"\">Select Type</option>\r\n");
      out.write("                        <option value=\"Income\">Income</option>\r\n");
      out.write("                        <option value=\"Expense\">Expense</option>\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"form-group\">\r\n");
      out.write("                    <label>Account <span style=\"color: red;\">*</span></label>\r\n");
      out.write("                    <select name=\"accountId\" class=\"form-input\" required>\r\n");
      out.write("                        <option value=\"\">Select Account</option>\r\n");
      out.write("                        ");
 for (Account acc : accounts) { 
                            if ("Active".equals(acc.getStatus())) { 
      out.write("\r\n");
      out.write("                        <option value=\"");
      out.print( acc.getAccountId() );
      out.write("\">\r\n");
      out.write("                            ");
      out.print( acc.getAccountName() );
      out.write(' ');
      out.write('(');
      out.write('$');
      out.print( String.format("%,.2f", acc.getBalance()) );
      out.write(")\r\n");
      out.write("                        </option>\r\n");
      out.write("                        ");
 }} 
      out.write("\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"form-group\">\r\n");
      out.write("                    <label>Category <span style=\"color: red;\">*</span></label>\r\n");
      out.write("                    <select name=\"categoryId\" id=\"categorySelect\" class=\"form-input\" required>\r\n");
      out.write("                        <option value=\"\">Select Category</option>\r\n");
      out.write("                        ");
 for (Category cat : categories) { 
      out.write("\r\n");
      out.write("                        <option value=\"");
      out.print( cat.getCategoryId() );
      out.write("\" data-type=\"");
      out.print( cat.getCategoryType() );
      out.write("\">\r\n");
      out.write("                            ");
      out.print( cat.getCategoryName() );
      out.write("\r\n");
      out.write("                        </option>\r\n");
      out.write("                        ");
 } 
      out.write("\r\n");
      out.write("                    </select>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"form-group\">\r\n");
      out.write("                    <label>Amount <span style=\"color: red;\">*</span></label>\r\n");
      out.write("                    <input type=\"number\" name=\"amount\" class=\"form-input\" step=\"0.01\" min=\"0.01\" required>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"form-group\">\r\n");
      out.write("                    <label>Date <span style=\"color: red;\">*</span></label>\r\n");
      out.write("                    <input type=\"date\" name=\"transactionDate\" class=\"form-input\" required value=\"");
      out.print( new SimpleDateFormat("yyyy-MM-dd").format(new java.util.Date()) );
      out.write("\">\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"form-group\">\r\n");
      out.write("                    <label>Description</label>\r\n");
      out.write("                    <textarea name=\"description\" class=\"form-input\" rows=\"3\"></textarea>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"modal-footer\">\r\n");
      out.write("                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeAddModal()\">Cancel</button>\r\n");
      out.write("                    <button type=\"submit\" class=\"btn btn-primary\">Add Transaction</button>\r\n");
      out.write("                </div>\r\n");
      out.write("            </form>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    <script>\r\n");
      out.write("        function showAddModal() {\r\n");
      out.write("            document.getElementById('addModal').style.display = 'block';\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function closeAddModal() {\r\n");
      out.write("            document.getElementById('addModal').style.display = 'none';\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function updateCategories(type) {\r\n");
      out.write("            const categorySelect = document.getElementById('categorySelect');\r\n");
      out.write("            const options = categorySelect.querySelectorAll('option');\r\n");
      out.write("            \r\n");
      out.write("            options.forEach(option => {\r\n");
      out.write("                if (option.value === '') {\r\n");
      out.write("                    option.style.display = 'block';\r\n");
      out.write("                } else {\r\n");
      out.write("                    const optionType = option.getAttribute('data-type');\r\n");
      out.write("                    option.style.display = (optionType === type || type === '') ? 'block' : 'none';\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            categorySelect.value = '';\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function filterTransactions() {\r\n");
      out.write("            const type = document.getElementById('filterType').value;\r\n");
      out.write("            const account = document.getElementById('filterAccount').value;\r\n");
      out.write("            const status = document.getElementById('filterStatus').value;\r\n");
      out.write("            \r\n");
      out.write("            const rows = document.querySelectorAll('#transactionsTableBody tr');\r\n");
      out.write("            \r\n");
      out.write("            rows.forEach(row => {\r\n");
      out.write("                const rowType = row.getAttribute('data-type');\r\n");
      out.write("                const rowAccount = row.getAttribute('data-account');\r\n");
      out.write("                const rowStatus = row.getAttribute('data-status');\r\n");
      out.write("                \r\n");
      out.write("                const matchType = !type || rowType === type;\r\n");
      out.write("                const matchAccount = !account || rowAccount === account;\r\n");
      out.write("                const matchStatus = !status || rowStatus === status;\r\n");
      out.write("                \r\n");
      out.write("                row.style.display = (matchType && matchAccount && matchStatus) ? '' : 'none';\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function viewTransaction(id) {\r\n");
      out.write("            // Implement view transaction details\r\n");
      out.write("            alert('View transaction: ' + id);\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function deleteTransaction(id) {\r\n");
      out.write("            if (confirm('Are you sure you want to delete this transaction?')) {\r\n");
      out.write("                window.location.href = '");
      out.print( request.getContextPath() );
      out.write("/transaction?action=delete&id=' + id;\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        // Close modal when clicking outside\r\n");
      out.write("        window.onclick = function(event) {\r\n");
      out.write("            const modal = document.getElementById('addModal');\r\n");
      out.write("            if (event.target == modal) {\r\n");
      out.write("                closeAddModal();\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("    </script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
